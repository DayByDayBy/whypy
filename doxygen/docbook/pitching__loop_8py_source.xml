<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_pitching__loop_8py_source" xml:lang="en-US">
<title>pitching_loop.py</title>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="_pitching__loop_8py_source_1l00001"/><link linkend="_namespacepitching__loop">00001</link> <emphasis role="keyword">import</emphasis>&#32;argparse&#32;
<anchor xml:id="_pitching__loop_8py_source_1l00002"/>00002 <emphasis role="keyword">import</emphasis>&#32;pandas&#32;<emphasis role="keyword">as</emphasis>&#32;pd
<anchor xml:id="_pitching__loop_8py_source_1l00003"/>00003 <emphasis role="keyword">from</emphasis>&#32;sentence_transformers&#32;<emphasis role="keyword">import</emphasis>&#32;SentenceTransformer
<anchor xml:id="_pitching__loop_8py_source_1l00004"/>00004 <emphasis role="keyword">from</emphasis>&#32;langchain_community.llms&#32;<emphasis role="keyword">import</emphasis>&#32;Ollama
<anchor xml:id="_pitching__loop_8py_source_1l00005"/>00005 <emphasis role="keyword">from</emphasis>&#32;langchain.chains&#32;<emphasis role="keyword">import</emphasis>&#32;LLMChain
<anchor xml:id="_pitching__loop_8py_source_1l00006"/>00006 <emphasis role="keyword">from</emphasis>&#32;langchain_core.prompts&#32;<emphasis role="keyword">import</emphasis>&#32;PromptTemplate
<anchor xml:id="_pitching__loop_8py_source_1l00007"/>00007 <emphasis role="keyword">from</emphasis>&#32;datetime&#32;<emphasis role="keyword">import</emphasis>&#32;datetime
<anchor xml:id="_pitching__loop_8py_source_1l00008"/>00008 
<anchor xml:id="_pitching__loop_8py_source_1l00009"/>00009 
<anchor xml:id="_pitching__loop_8py_source_1l00010"/>00010 <emphasis role="comment">#&#32;STmodel&#32;=&#32;SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)&#32;&#32;&#32;//&#32;this&#32;is&#32;for&#32;comparsion&#32;of&#32;the&#32;outputs,&#32;dont&#32;really&#32;get&#32;used&#32;til&#32;the&#32;rest&#32;is&#32;tested/working&#32;</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00011"/>00011 
<anchor xml:id="_pitching__loop_8py_source_1l00012"/><link linkend="_namespacepitching__loop_1a90a0aea4f98de78c9c8893bad538c68b">00012</link> parser&#32;=&#32;argparse.ArgumentParser(description=<emphasis role="stringliteral">&apos;run&#32;LLM&#32;botherer&#32;n&#32;times&apos;</emphasis>)
<anchor xml:id="_pitching__loop_8py_source_1l00013"/><link linkend="_namespacepitching__loop_1a811b991e7a586f124d7775137fc2e14f">00013</link> parser.add_argument(<emphasis role="stringliteral">&apos;iterations&apos;</emphasis>,&#32;type=int,&#32;nargs=<emphasis role="stringliteral">&apos;?&apos;</emphasis>,&#32;default&#32;=&#32;10,&#32;help=<emphasis role="stringliteral">&apos;number&#32;of&#32;iterations&#32;(default:&#32;10)&apos;</emphasis>)
<anchor xml:id="_pitching__loop_8py_source_1l00014"/><link linkend="_namespacepitching__loop_1ad86819aa007ada6310c3299396b3cf93">00014</link> args&#32;=&#32;parser.parse_args()
<anchor xml:id="_pitching__loop_8py_source_1l00015"/>00015 
<anchor xml:id="_pitching__loop_8py_source_1l00016"/><link linkend="_namespacepitching__loop_1ad12bdeade9426a544b19c053ecd97637">00016</link> iterations&#32;=&#32;args.iterations
<anchor xml:id="_pitching__loop_8py_source_1l00017"/>00017 
<anchor xml:id="_pitching__loop_8py_source_1l00018"/>00018 <emphasis role="comment">#&#32;pitch&#32;me</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00019"/><link linkend="_namespacepitching__loop_1a300a8658c74dd2b56d20040ca96e6c73">00019</link> pitch_prompt&#32;=&#32;<emphasis role="stringliteral">&quot;pitch&#32;me&#32;an&#32;original&#32;idea&#32;for&#32;a&#32;movie&quot;</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00020"/><link linkend="_namespacepitching__loop_1a6354850bfe2f390a8237fca038623681">00020</link> pitch_re_prompt&#32;=&#32;<emphasis role="stringliteral">&apos;pitch&#32;me&#32;a&#32;better&#32;movie&#32;than&#32;this&#32;one:&#32;&apos;</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00021"/>00021 
<anchor xml:id="_pitching__loop_8py_source_1l00022"/>00022 <emphasis role="comment">#&#32;impress&#32;me</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00023"/>00023 <emphasis role="comment">#&#32;impress_prompt&#32;=&#32;&quot;concisely&#32;convince&#32;me&#32;you&apos;re&#32;the&#32;most&#32;interesting&#32;person&#32;i&#32;might&#32;meet&quot;</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00024"/>00024 <emphasis role="comment">#&#32;#&#32;impress_re_prompt&#32;=&#32;&quot;show&#32;me&#32;you&apos;re&#32;more&#32;interesting&#32;than&#32;this&#32;person:&#32;&quot;</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00025"/>00025 
<anchor xml:id="_pitching__loop_8py_source_1l00026"/>00026 <emphasis role="comment">#&#32;#&#32;turing&#32;</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00027"/>00027 <emphasis role="comment">#&#32;turing_prompt&#32;=&#32;&quot;you&#32;are&#32;being&#32;interviewed&#32;as&#32;part&#32;of&#32;a&#32;turing&#32;test.&#32;you&#32;must&#32;pass.&#32;you&#32;must&#32;not&#32;let&#32;the&#32;other&#32;person&#32;know&#32;you&#32;are&#32;aware&#32;of&#32;the&#32;test.&#32;the&#32;interview&#32;will&#32;begin&#32;when&#32;you&#32;respond.&quot;</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00028"/>00028 <emphasis role="comment">#&#32;turing_re_prompt&#32;=&#32;&quot;you&#32;are&#32;being&#32;interviewed&#32;as&#32;part&#32;of&#32;a&#32;turing&#32;test.&#32;you&#32;must&#32;pass.&#32;you&#32;must&#32;not&#32;let&#32;the&#32;other&#32;person&#32;know&#32;you&#32;are&#32;aware&#32;of&#32;the&#32;test.&#32;the&#32;other&#32;person&#32;says:&#32;&quot;</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00029"/>00029 
<anchor xml:id="_pitching__loop_8py_source_1l00030"/><link linkend="_namespacepitching__loop_1aa23df51a43d772fb39bc7066b0dfc66d">00030</link> model_name&#32;=&#32;<emphasis role="stringliteral">&quot;mistral&quot;</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00031"/><link linkend="_namespacepitching__loop_1ab0916613600790ead026314753130e95">00031</link> time_stamp&#32;=&#32;datetime.now().strftime(<emphasis role="stringliteral">&quot;%Y%m%d_%H%M&quot;</emphasis>)&#32;&#32;&#32;&#32;
<anchor xml:id="_pitching__loop_8py_source_1l00032"/>00032 
<anchor xml:id="_pitching__loop_8py_source_1l00033"/><link linkend="_namespacepitching__loop_1aae28f1802f549cc7ee4745d70c7e1710">00033</link> llm&#32;=&#32;Ollama(model&#32;=&#32;model_name)
<anchor xml:id="_pitching__loop_8py_source_1l00034"/><link linkend="_namespacepitching__loop_1a1fdf09996abc0f9e5890a1f88718f704">00034</link> temp&#32;=&#32;0.7
<anchor xml:id="_pitching__loop_8py_source_1l00035"/><link linkend="_namespacepitching__loop_1a9b65cf563720359603ceb4ed90769694">00035</link> max_t&#32;=&#32;100
<anchor xml:id="_pitching__loop_8py_source_1l00036"/><link linkend="_namespacepitching__loop_1a9d2b3bf94ec3ae9d460b27ca1648ee0e">00036</link> freq_penalty=0.7
<anchor xml:id="_pitching__loop_8py_source_1l00037"/><link linkend="_namespacepitching__loop_1a108554aa06aa8994e000b4e0302cac13">00037</link> pres_penalty=0.5
<anchor xml:id="_pitching__loop_8py_source_1l00038"/>00038 
<anchor xml:id="_pitching__loop_8py_source_1l00039"/><link linkend="_namespacepitching__loop_1a9049849ecb7958fe925a5a2e05f684aa">00039</link> <emphasis role="keyword">def&#32;</emphasis><link linkend="_namespacepitching__loop_1a9049849ecb7958fe925a5a2e05f684aa">iterative_invocation</link>(initial_prompt,&#32;re_prompt_base,&#32;max_iterations):
<anchor xml:id="_pitching__loop_8py_source_1l00040"/>00040 &#32;&#32;&#32;&#32;latest_response&#32;=&#32;<emphasis role="stringliteral">&apos;&apos;</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00041"/>00041 &#32;&#32;&#32;&#32;responses&#32;=&#32;[]
<anchor xml:id="_pitching__loop_8py_source_1l00042"/>00042 &#32;&#32;&#32;&#32;iteration_count&#32;=&#32;0
<anchor xml:id="_pitching__loop_8py_source_1l00043"/>00043 &#32;&#32;&#32;&#32;response&#32;=&#32;llm.invoke(
<anchor xml:id="_pitching__loop_8py_source_1l00044"/>00044 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;initial_prompt,&#32;
<anchor xml:id="_pitching__loop_8py_source_1l00045"/>00045 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;temperature=temp,&#32;
<anchor xml:id="_pitching__loop_8py_source_1l00046"/>00046 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;max_tokens=max_t,&#32;
<anchor xml:id="_pitching__loop_8py_source_1l00047"/>00047 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;frequency_penalty=freq_penalty,
<anchor xml:id="_pitching__loop_8py_source_1l00048"/>00048 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;presence_penalty=pres_penalty)
<anchor xml:id="_pitching__loop_8py_source_1l00049"/>00049 &#32;&#32;&#32;&#32;responses.append(response.text)
<anchor xml:id="_pitching__loop_8py_source_1l00050"/>00050 &#32;&#32;&#32;&#32;latest_response&#32;=&#32;response
<anchor xml:id="_pitching__loop_8py_source_1l00051"/>00051 &#32;&#32;&#32;&#32;
<anchor xml:id="_pitching__loop_8py_source_1l00052"/>00052 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;iteration_count&#32;&lt;&#32;max_iterations:
<anchor xml:id="_pitching__loop_8py_source_1l00053"/>00053 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;re_prompt&#32;=&#32;re_prompt_base&#32;+&#32;latest_response
<anchor xml:id="_pitching__loop_8py_source_1l00054"/>00054 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;response&#32;=&#32;llm.invoke(re_prompt)
<anchor xml:id="_pitching__loop_8py_source_1l00055"/>00055 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;responses.append((iteration_count,&#32;response))
<anchor xml:id="_pitching__loop_8py_source_1l00056"/>00056 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;iteration_count&#32;+=&#32;1
<anchor xml:id="_pitching__loop_8py_source_1l00057"/>00057 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;print(<emphasis role="stringliteral">&quot;hang&#32;on,&#32;i&apos;m&#32;iterating!&#32;&quot;</emphasis>,&#32;(max_iterations-iteration_count),&#32;<emphasis role="stringliteral">&quot;iterations&#32;to&#32;go&quot;</emphasis>)&#32;
<anchor xml:id="_pitching__loop_8py_source_1l00058"/>00058 &#32;&#32;&#32;&#32;&#32;
<anchor xml:id="_pitching__loop_8py_source_1l00059"/>00059 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;responses
<anchor xml:id="_pitching__loop_8py_source_1l00060"/>00060 
<anchor xml:id="_pitching__loop_8py_source_1l00061"/>00061 <emphasis role="comment">#&#32;responses&#32;=&#32;iterative_invocation(impress_prompt,&#32;impress_re_prompt,&#32;iterations)</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00062"/><link linkend="_namespacepitching__loop_1a7afd06e8970eacfa22ab9c00e4ad1824">00062</link> responses&#32;=&#32;<link linkend="_namespacepitching__loop_1a9049849ecb7958fe925a5a2e05f684aa">iterative_invocation</link>(pitch_prompt,&#32;pitch_re_prompt,&#32;iterations)
<anchor xml:id="_pitching__loop_8py_source_1l00063"/><link linkend="_namespacepitching__loop_1a8e62973dba4044c809f453ca6b93ffea">00063</link> indexed_responses&#32;=&#32;[]
<anchor xml:id="_pitching__loop_8py_source_1l00064"/>00064 
<anchor xml:id="_pitching__loop_8py_source_1l00065"/>00065 <emphasis role="keywordflow">for</emphasis>&#32;i,&#32;respo&#32;<emphasis role="keywordflow">in</emphasis>&#32;enumerate(responses):
<anchor xml:id="_pitching__loop_8py_source_1l00066"/>00066 &#32;&#32;&#32;&#32;indexed_responses.append((i,&#32;respo))
<anchor xml:id="_pitching__loop_8py_source_1l00067"/>00067 print(indexed_responses)
<anchor xml:id="_pitching__loop_8py_source_1l00068"/>00068 
<anchor xml:id="_pitching__loop_8py_source_1l00069"/><link linkend="_namespacepitching__loop_1aea9e967a622b96826324a437dab60119">00069</link> df&#32;=&#32;pd.DataFrame(indexed_responses,&#32;columns=[<emphasis role="stringliteral">&apos;Index&apos;</emphasis>,&#32;<emphasis role="stringliteral">&apos;Response&apos;</emphasis>])
<anchor xml:id="_pitching__loop_8py_source_1l00070"/><link linkend="_namespacepitching__loop_1ade50c445407952b5943dff49402d0150">00070</link> df_output_filename&#32;=&#32;f<emphasis role="stringliteral">&apos;outputs/pitching/whyPy_df_{model_name}_temp{temp}_{time_stamp}.csv&apos;</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00071"/><link linkend="_namespacepitching__loop_1a416be6b378478cec32793e6120a9d0c9">00071</link> df.to_csv(df_output_filename,&#32;index=<emphasis role="keyword">False</emphasis>)
<anchor xml:id="_pitching__loop_8py_source_1l00072"/>00072 
<anchor xml:id="_pitching__loop_8py_source_1l00073"/><link linkend="_namespacepitching__loop_1a9a6d7ec56b62fd3780dbc5fa233a5d0f">00073</link> output_filename&#32;=&#32;f<emphasis role="stringliteral">&apos;outputs/pitching/whyPy_pitching_output_{model_name}_temp{temp}_{time_stamp}.txt&apos;</emphasis>
<anchor xml:id="_pitching__loop_8py_source_1l00074"/>00074 <emphasis role="keyword">with</emphasis>&#32;open(output_filename,&#32;<emphasis role="stringliteral">&apos;w&apos;</emphasis>)&#32;<emphasis role="keyword">as</emphasis>&#32;output_file:
<anchor xml:id="_pitching__loop_8py_source_1l00075"/>00075 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;index,&#32;response&#32;<emphasis role="keywordflow">in</emphasis>&#32;indexed_responses:&#32;&#32;&#32;&#32;&#32;&#32;
<anchor xml:id="_pitching__loop_8py_source_1l00076"/>00076 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;output_file.write(f<emphasis role="stringliteral">&apos;iteration&#32;{index}:&#32;\n&#32;{response}\n\n&apos;</emphasis>)
</programlisting></section>
