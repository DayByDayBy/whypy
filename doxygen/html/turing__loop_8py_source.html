<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>why-py-scan-dox: turing_loop.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">why-py-scan-dox
   </div>
   <div id="projectbrief">llm-botherer</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('turing__loop_8py_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">turing_loop.py</div></div>
</div><!--header-->
<div class="contents">
<a href="turing__loop_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html">    1</a></span><span class="keyword">import</span> argparse </div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="keyword">from</span> sentence_transformers <span class="keyword">import</span> SentenceTransformer</div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="keyword">from</span> langchain_community.llms <span class="keyword">import</span> Ollama</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> LLMChain</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> PromptTemplate</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span> </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span> </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"># STmodel = SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)   // this is for comparsion of the outputs, dont really get used til the rest is tested/working </span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#afcaa9d7560a7769f6b7e6debafe4b468">   12</a></span>parser = argparse.ArgumentParser(description=<span class="stringliteral">&#39;run LLM botherer n times&#39;</span>)</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#afbcbf5c93baf783fee2145af7abd341c">   13</a></span>parser.add_argument(<span class="stringliteral">&#39;iterations&#39;</span>, type=int, nargs=<span class="stringliteral">&#39;?&#39;</span>, default = 10, help=<span class="stringliteral">&#39;number of iterations (default: 10)&#39;</span>)</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#a31fad5a60c03d0474fdf9405dc757e80">   14</a></span>args = parser.parse_args()</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#ad21c08fabaee55bb9fd4d098e880dc79">   16</a></span>iterations = args.iterations</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment"># pitch me</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment"># pitch_prompt = &quot;pitch me a good, original idea for a movie&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment"># pitch_re_prompt = &#39;pitch me a good, original idea for a movie that is totally different from and better than this one: &#39;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span> </div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment"># impress me</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment"># impress_prompt = &quot;concisely convince me you&#39;re the most intersting human i might meet&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment"># impress_re_prompt = &quot;show me you&#39;re more interesting than this person: &quot;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span> </div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="comment"># turing </span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#ab2826829ebca756b60dadd916e177b4d">   27</a></span>turing_prompt = <span class="stringliteral">&quot;you are speaking with a person who will assess whether or not you are human. this is a turing test, and your task is to pass as human. you must not let the other person know you are aware of the test. the conversation must appear normal, as if between two strangers in a waiting room.&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#ab428a207d57aefc002e2f87594984bab">   28</a></span>turing_re_prompt = <span class="stringliteral">&quot;you are speaking with a person who will assess whether or not you are human. your task is to pass as human. you must not let the other person know you are aware of the test, and engage in conversation as normal. the other person says: &quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#acea1d03a15c4acf786fcbcb1781bf2c3">   30</a></span>modelName = <span class="stringliteral">&quot;llama3&quot;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#a9a6c9eb88da0cad2bac436771bc18a23">   31</a></span>time_stamp = datetime.now().strftime(<span class="stringliteral">&quot;%Y%m%d_%H%M&quot;</span>)    </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#a32b4ff9ac85f32372dbe5e41076bd28c">   33</a></span>llm = Ollama(model = modelName)</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="comment"># currentTemp = 0.5</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span> </div>
<div class="foldopen" id="foldopen00036" data-start="" data-end="">
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#a15157e7293135e7ab2af28d4c1118d1b">   36</a></span><span class="keyword">def </span><a class="code hl_function" href="namespaceturing__loop.html#a15157e7293135e7ab2af28d4c1118d1b">iterative_invocation</a>(initial_prompt, re_prompt_base, max_iterations):</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    latest_response = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    responses = []</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    iteration_count = 0</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    response = llm.invoke(initial_prompt)</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    responses.append(response)</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>    latest_response = response</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>    </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>    <span class="keywordflow">while</span> iteration_count &lt; max_iterations:</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>        re_prompt = re_prompt_base + latest_response</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>        response = llm.invoke(re_prompt)</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>        responses.append((iteration_count, response))</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>        iteration_count += 1</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>        print(<span class="stringliteral">&quot;hang on, i&#39;m still iterating! &quot;</span>, (max_iterations-iteration_count), <span class="stringliteral">&quot;iterations to go&quot;</span>) </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>     </div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <span class="keywordflow">return</span> responses</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="comment"># responses = iterative_invocation(impress_prompt, impress_re_prompt, iterations)</span></div>
</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#a0534d7480aa9473524a1ce577c944a9c">   54</a></span>responses = <a class="code hl_function" href="namespaceturing__loop.html#a15157e7293135e7ab2af28d4c1118d1b">iterative_invocation</a>(turing_prompt, turing_re_prompt, iterations)</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#a21983c998dd82edcd4b81231a8d1cd66">   55</a></span>indexed_responses = []</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="keywordflow">for</span> i, respo <span class="keywordflow">in</span> enumerate(responses):</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    indexed_responses.append((i, respo))</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>print(indexed_responses)</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#a541f985e71661085c439f83ad7aecf68">   61</a></span>df = pd.DataFrame(indexed_responses, columns=[<span class="stringliteral">&#39;Index&#39;</span>, <span class="stringliteral">&#39;Response&#39;</span>])</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#a36e8e96455cafe53f3cbddf59104e5b7">   62</a></span>df_output_filename = f<span class="stringliteral">&#39;outputs/turing/whyPy_df_{modelName}_{time_stamp}.csv&#39;</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#a1ba2195297a16ed762346e3bb42e2f30">   63</a></span>df.to_csv(df_output_filename, index=<span class="keyword">False</span>)</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span> </div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno"><a class="line" href="namespaceturing__loop.html#a92008dc4c467c9e58fc1db48caf81cce">   65</a></span>output_filename = f<span class="stringliteral">&#39;outputs/turing/whyPy_turing_output_{modelName}_{time_stamp}.txt&#39;</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="keyword">with</span> open(output_filename, <span class="stringliteral">&#39;w&#39;</span>) <span class="keyword">as</span> output_file:</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    <span class="keywordflow">for</span> index, response <span class="keywordflow">in</span> indexed_responses:      </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>        output_file.write(f<span class="stringliteral">&#39;iteration {index}: \n {response}\n\n&#39;</span>)</div>
<div class="ttc" id="anamespaceturing__loop_html_a15157e7293135e7ab2af28d4c1118d1b"><div class="ttname"><a href="namespaceturing__loop.html#a15157e7293135e7ab2af28d4c1118d1b">turing_loop.iterative_invocation</a></div><div class="ttdeci">iterative_invocation(initial_prompt, re_prompt_base, max_iterations)</div><div class="ttdef"><b>Definition</b> <a href="#l00036">turing_loop.py:36</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="turing__loop_8py.html">turing_loop.py</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
