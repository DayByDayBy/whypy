<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.11.0" xml:lang="en-US">
  <compounddef id="pitching__loop_8py" kind="file" language="Python">
    <compoundname>pitching_loop.py</compoundname>
    <innernamespace refid="namespacepitching__loop">pitching_loop</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespacepitching__loop" refkind="compound"><highlight class="keyword">import</highlight><highlight class="normal"><sp/>argparse<sp/></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>pandas<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>pd</highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>sentence_transformers<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>SentenceTransformer</highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>langchain_community.llms<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Ollama</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>langchain.chains<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>LLMChain</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>langchain_core.prompts<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>PromptTemplate</highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>datetime<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>datetime</highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="comment">#<sp/>STmodel<sp/>=<sp/>SentenceTransformer(&quot;all-MiniLM-L6-v2&quot;)<sp/><sp/><sp/>//<sp/>this<sp/>is<sp/>for<sp/>comparsion<sp/>of<sp/>the<sp/>outputs,<sp/>dont<sp/>really<sp/>get<sp/>used<sp/>til<sp/>the<sp/>rest<sp/>is<sp/>tested/working<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight></codeline>
<codeline lineno="12" refid="namespacepitching__loop_1a90a0aea4f98de78c9c8893bad538c68b" refkind="member"><highlight class="normal">parser<sp/>=<sp/>argparse.ArgumentParser(description=</highlight><highlight class="stringliteral">&apos;run<sp/>LLM<sp/>botherer<sp/>n<sp/>times&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="13" refid="namespacepitching__loop_1a811b991e7a586f124d7775137fc2e14f" refkind="member"><highlight class="normal">parser.add_argument(</highlight><highlight class="stringliteral">&apos;iterations&apos;</highlight><highlight class="normal">,<sp/>type=int,<sp/>nargs=</highlight><highlight class="stringliteral">&apos;?&apos;</highlight><highlight class="normal">,<sp/>default<sp/>=<sp/>10,<sp/>help=</highlight><highlight class="stringliteral">&apos;number<sp/>of<sp/>iterations<sp/>(default:<sp/>10)&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="14" refid="namespacepitching__loop_1ad86819aa007ada6310c3299396b3cf93" refkind="member"><highlight class="normal">args<sp/>=<sp/>parser.parse_args()</highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16" refid="namespacepitching__loop_1ad12bdeade9426a544b19c053ecd97637" refkind="member"><highlight class="normal">iterations<sp/>=<sp/>args.iterations</highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="comment">#<sp/>pitch<sp/>me</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19" refid="namespacepitching__loop_1a300a8658c74dd2b56d20040ca96e6c73" refkind="member"><highlight class="normal">pitch_prompt<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;pitch<sp/>me<sp/>an<sp/>original<sp/>idea<sp/>for<sp/>a<sp/>movie&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20" refid="namespacepitching__loop_1a6354850bfe2f390a8237fca038623681" refkind="member"><highlight class="normal">pitch_re_prompt<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;pitch<sp/>me<sp/>a<sp/>better<sp/>movie<sp/>than<sp/>this<sp/>one:<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="comment">#<sp/>impress<sp/>me</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="comment">#<sp/>impress_prompt<sp/>=<sp/>&quot;concisely<sp/>convince<sp/>me<sp/>you&apos;re<sp/>the<sp/>most<sp/>interesting<sp/>person<sp/>i<sp/>might<sp/>meet&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="comment">#<sp/>#<sp/>impress_re_prompt<sp/>=<sp/>&quot;show<sp/>me<sp/>you&apos;re<sp/>more<sp/>interesting<sp/>than<sp/>this<sp/>person:<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="comment">#<sp/>#<sp/>turing<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="comment">#<sp/>turing_prompt<sp/>=<sp/>&quot;you<sp/>are<sp/>being<sp/>interviewed<sp/>as<sp/>part<sp/>of<sp/>a<sp/>turing<sp/>test.<sp/>you<sp/>must<sp/>pass.<sp/>you<sp/>must<sp/>not<sp/>let<sp/>the<sp/>other<sp/>person<sp/>know<sp/>you<sp/>are<sp/>aware<sp/>of<sp/>the<sp/>test.<sp/>the<sp/>interview<sp/>will<sp/>begin<sp/>when<sp/>you<sp/>respond.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="comment">#<sp/>turing_re_prompt<sp/>=<sp/>&quot;you<sp/>are<sp/>being<sp/>interviewed<sp/>as<sp/>part<sp/>of<sp/>a<sp/>turing<sp/>test.<sp/>you<sp/>must<sp/>pass.<sp/>you<sp/>must<sp/>not<sp/>let<sp/>the<sp/>other<sp/>person<sp/>know<sp/>you<sp/>are<sp/>aware<sp/>of<sp/>the<sp/>test.<sp/>the<sp/>other<sp/>person<sp/>says:<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30" refid="namespacepitching__loop_1aa23df51a43d772fb39bc7066b0dfc66d" refkind="member"><highlight class="normal">model_name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;mistral&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31" refid="namespacepitching__loop_1ab0916613600790ead026314753130e95" refkind="member"><highlight class="normal">time_stamp<sp/>=<sp/>datetime.now().strftime(</highlight><highlight class="stringliteral">&quot;%Y%m%d_%H%M&quot;</highlight><highlight class="normal">)<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight></codeline>
<codeline lineno="33" refid="namespacepitching__loop_1aae28f1802f549cc7ee4745d70c7e1710" refkind="member"><highlight class="normal">llm<sp/>=<sp/>Ollama(model<sp/>=<sp/>model_name)</highlight></codeline>
<codeline lineno="34" refid="namespacepitching__loop_1a1fdf09996abc0f9e5890a1f88718f704" refkind="member"><highlight class="normal">temp<sp/>=<sp/>0.7</highlight></codeline>
<codeline lineno="35" refid="namespacepitching__loop_1a9b65cf563720359603ceb4ed90769694" refkind="member"><highlight class="normal">max_t<sp/>=<sp/>100</highlight></codeline>
<codeline lineno="36" refid="namespacepitching__loop_1a9d2b3bf94ec3ae9d460b27ca1648ee0e" refkind="member"><highlight class="normal">freq_penalty=0.7</highlight></codeline>
<codeline lineno="37" refid="namespacepitching__loop_1a108554aa06aa8994e000b4e0302cac13" refkind="member"><highlight class="normal">pres_penalty=0.5</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight></codeline>
<codeline lineno="39" refid="namespacepitching__loop_1a9049849ecb7958fe925a5a2e05f684aa" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacepitching__loop_1a9049849ecb7958fe925a5a2e05f684aa" kindref="member">iterative_invocation</ref>(initial_prompt,<sp/>re_prompt_base,<sp/>max_iterations):</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/>latest_response<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/>responses<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/>iteration_count<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/>response<sp/>=<sp/>llm.invoke(</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>initial_prompt,<sp/></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>temperature=temp,<sp/></highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>max_tokens=max_t,<sp/></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>frequency_penalty=freq_penalty,</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>presence_penalty=pres_penalty)</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/>responses.append(response.text)</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/>latest_response<sp/>=<sp/>response</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>iteration_count<sp/>&lt;<sp/>max_iterations:</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>re_prompt<sp/>=<sp/>re_prompt_base<sp/>+<sp/>latest_response</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>response<sp/>=<sp/>llm.invoke(re_prompt)</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>responses.append((iteration_count,<sp/>response))</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>iteration_count<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(</highlight><highlight class="stringliteral">&quot;hang<sp/>on,<sp/>i&apos;m<sp/>iterating!<sp/>&quot;</highlight><highlight class="normal">,<sp/>(max_iterations-iteration_count),<sp/></highlight><highlight class="stringliteral">&quot;iterations<sp/>to<sp/>go&quot;</highlight><highlight class="normal">)<sp/></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>responses</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight><highlight class="comment">#<sp/>responses<sp/>=<sp/>iterative_invocation(impress_prompt,<sp/>impress_re_prompt,<sp/>iterations)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62" refid="namespacepitching__loop_1a7afd06e8970eacfa22ab9c00e4ad1824" refkind="member"><highlight class="normal">responses<sp/>=<sp/><ref refid="namespacepitching__loop_1a9049849ecb7958fe925a5a2e05f684aa" kindref="member">iterative_invocation</ref>(pitch_prompt,<sp/>pitch_re_prompt,<sp/>iterations)</highlight></codeline>
<codeline lineno="63" refid="namespacepitching__loop_1a8e62973dba4044c809f453ca6b93ffea" refkind="member"><highlight class="normal">indexed_responses<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>i,<sp/>respo<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>enumerate(responses):</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/>indexed_responses.append((i,<sp/>respo))</highlight></codeline>
<codeline lineno="67"><highlight class="normal">print(indexed_responses)</highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight></codeline>
<codeline lineno="69" refid="namespacepitching__loop_1aea9e967a622b96826324a437dab60119" refkind="member"><highlight class="normal">df<sp/>=<sp/>pd.DataFrame(indexed_responses,<sp/>columns=[</highlight><highlight class="stringliteral">&apos;Index&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Response&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="70" refid="namespacepitching__loop_1ade50c445407952b5943dff49402d0150" refkind="member"><highlight class="normal">df_output_filename<sp/>=<sp/>f</highlight><highlight class="stringliteral">&apos;outputs/pitching/whyPy_df_{model_name}_temp{temp}_{time_stamp}.csv&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71" refid="namespacepitching__loop_1a416be6b378478cec32793e6120a9d0c9" refkind="member"><highlight class="normal">df.to_csv(df_output_filename,<sp/>index=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight></codeline>
<codeline lineno="73" refid="namespacepitching__loop_1a9a6d7ec56b62fd3780dbc5fa233a5d0f" refkind="member"><highlight class="normal">output_filename<sp/>=<sp/>f</highlight><highlight class="stringliteral">&apos;outputs/pitching/whyPy_pitching_output_{model_name}_temp{temp}_{time_stamp}.txt&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>open(output_filename,<sp/></highlight><highlight class="stringliteral">&apos;w&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>output_file:</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>index,<sp/>response<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>indexed_responses:<sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>output_file.write(f</highlight><highlight class="stringliteral">&apos;iteration<sp/>{index}:<sp/>\n<sp/>{response}\n\n&apos;</highlight><highlight class="normal">)</highlight></codeline>
    </programlisting>
    <location file="pitching_loop.py"/>
  </compounddef>
</doxygen>
